"use strict";define(["listload","cookie","template","lunbo","listload"],function(r,c,n,p,e){function a(){this.flag=!0,this.template=n,this.indexpage=1}return a.prototype.init=function(i,o){var n=this;$("#header").load("/html/header.html",function(){o&&$("#lunboshow").load("/html/lunbo.html",function(){p.init()});var e=c.getCookie("user"),a=""==e?[]:JSON.parse(e);if(e){var t="欢迎"+a[0].username+"来到漫骆驼!  <a href='/html/user.html' style='color:#FA8072'>用户中心</a>&nbsp;<a href='javascrpit:;' style='text-decoration:underline;color:blue;'>退出</a>";$("#header_login").html(t)}$("#search").on("click",function(e){e.preventDefault();var a=$("#keywords").val();$(location).attr("href","/html/list.html?act=search&keywords="+a)}),$(".search a").on("click",function(){var e=$(this).html();$(location).attr("href","/html/list.html?act=search&keywords="+e)}),r.listClick(),n.index(i)}),$("#footer").load("/html/footer.html",function(){n.toTop()})},a.prototype.index=function(o){for(var e=0,a=[],t=c.getCookie("cookie"),n=""==t?[]:JSON.parse(t),i=0;i<n.length;i++)a[i]=n[i].id,e+=parseInt(n[i].count);$("#thingcount").html(e),$("#cart").hover(function(){if(0!=n.length){var e={act:"cart"};e.id=a,$.get("http://localhost/www/php/detail.php",e,function(e){e=JSON.parse(e);for(var a=0;a<e.length;a++)for(var t=0;t<n.length;t++)e[a].id===n[t].id&&(e[a].count=n[t].count);console.log(e);var i=o("showcartcon",{data:e});$("#showcart").html(i)})}else{$("#showcart").html("<li>您的购物车暂无商品 赶快选择心爱的产品吧!<li>")}},function(){$("#showcart").html("")})},a.prototype.search=function(e){var o=this,a={keywords:e,act:"search",pageCount:12,index:o.indexpage};$.get("http://localhost/www/php/detail.php",a,function(e){var a,t=(e=JSON.parse(e)).length;a=Math.ceil(t/12),console.log(e);var i=n("list",{data:e});$("#content_con_goods").html(i),o.listsearch(o.template,a,$("#search"))})},a.prototype.listsearch=function(e,a,t){var i=this,o="";if(i.flag){o+='<a href="javascript:;" id="goprev">上一页</a>';for(var n=1;n<=a;n++)o+=1==n?'<a href="javascript:;" class = "pageclick">'+n+"</a>":'<a href="javascript:;">'+n+"</a>";o+='<a href="javascript:;" id="gonext">下一页</a>',$("#pagechange").html(o),i.indexpage==a?$("#gonext").replaceWith('<span id="gonext">下一页</span>'):$("#gonext").replaceWith('<a href="javascript:;" id="gonext">下一页</a>'),1==i.indexpage?$("#goprev").replaceWith('<span id = "goprev">上一页</span>'):$("#goprev").replaceWith('<a href="javascript:;" id="goprev">上一页</a>'),i.listchange(a,e,t),i.flag=!1}},a.prototype.listchange=function(a,t,i){var o=this;$("#pagechange a").on("click",function(){var e=this.innerHTML;isNaN(Number(e))?"goprev"===this.id?(o.indexpage--,o.indexpage<1&&(o.indexpage=1),$("#pagechange a").eq(o.indexpage).addClass("pageclick").siblings().removeClass("pageclick"),1==o.indexpage?$(this).replaceWith('<span id="goprev">上一页</span>'):($("#gonext").replaceWith('<a href="javascript:;" id="gonext">下一页</a>'),$(this).replaceWith('<a href="javascript:;" id="goprev">上一页</a>'),o.listchange(a,t,i))):"gonext"===this.id&&(o.indexpage++,o.indexpage>a&&(o.indexpage=a),$("#pagechange").children().eq(o.indexpage).addClass("pageclick").siblings().removeClass("pageclick"),o.indexpage==a?$(this).replaceWith('<span id="gonext">下一页</span>'):($(this).replaceWith('<a href="javascript:;" id="gonext">下一页</a>'),$("#goprev").replaceWith('<a href="javascript:;" id="goprev">上一页</a>'),o.listchange(a,t,i))):(o.indexpage=Number(e),$(this).addClass("pageclick").siblings().removeClass("pageclick"),o.indexpage==a?$("#gonext").replaceWith('<span id="gonext">下一页</span>'):1==o.indexpage?$("#goprev").replaceWith('<span id = "goprev">上一页</span>'):($("#goprev").replaceWith('<a href="javascript:;" id="goprev">上一页</a>'),$("#gonext").replaceWith('<a href="javascript:;" id="gonext">下一页</a>'),o.listchange(a,t,i))),o.search(t,i)})},a.prototype.toTop=function(){$(".totop a").on("click",function(){$(document).scrollTop(0)})},new a});